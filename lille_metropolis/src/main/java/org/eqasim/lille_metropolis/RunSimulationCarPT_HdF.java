package org.eqasim.lille_metropolis;

import org.eqasim.core.components.car_pt.routing.EqasimCarPtModule;
import org.eqasim.core.components.car_pt.routing.EqasimPtCarModule;
import org.eqasim.core.components.config.EqasimConfigGroup;
import org.eqasim.core.simulation.analysis.EqasimAnalysisModule;
import org.eqasim.core.simulation.mode_choice.EqasimModeChoiceModuleCarPt;
import org.eqasim.lille_metropolis.mode_choice.MELModeChoiceModuleCarPt;
import org.matsim.api.core.v01.Coord;
import org.matsim.api.core.v01.Scenario;
import org.matsim.contribs.discrete_mode_choice.modules.config.DiscreteModeChoiceConfigGroup;
import org.matsim.core.config.CommandLine;
import org.matsim.core.config.CommandLine.ConfigurationException;
import org.matsim.core.config.Config;
import org.matsim.core.config.ConfigUtils;
import org.matsim.core.config.groups.PlanCalcScoreConfigGroup;
import org.matsim.core.config.groups.PlanCalcScoreConfigGroup.ActivityParams;
import org.matsim.core.config.groups.PlanCalcScoreConfigGroup.ModeParams;
import org.matsim.core.config.groups.StrategyConfigGroup.StrategySettings;
import org.matsim.core.controler.Controler;
import org.matsim.core.scenario.ScenarioUtils;

import java.util.ArrayList;
import java.util.Collection;
import java.util.HashSet;
import java.util.List;

public class RunSimulationCarPT_HdF {
    static public void main(String[] args) throws ConfigurationException {
        CommandLine cmd = new CommandLine.Builder(args) //
                .requireOptions("config-path") //
                .allowPrefixes("mode-choice-parameter", "cost-parameter") //
                .build();

        // Global config definition
        Config config = ConfigUtils.loadConfig(cmd.getOptionStrict("config-path"), MELConfigurator.getConfigGroups());
        cmd.applyConfiguration(config);

        // Park and ride lot location
        List<Coord> parkRideCoords = new ArrayList<Coord>();

        double[] xCoord = {695217.09, 691365.43, 703543.53, 702770.20, 693929.84, 704530.69, 708963.08, 711811.05,
                685914.90, 712180.02, 702337.39, 709906.41, 651632.753989448,658547.918111028,658239.407444937
                ,661860.13442922
                ,655526.866861409
                ,699530.389882646
                ,706857.001271754
                ,710452.422205462
                ,708144.879113783
                ,707060.642165747
                ,713710.009122573
                ,713438.098217682
                ,714347.067662717
                ,715557.242225856
                ,716396.07645571
                ,759815.233906181
                ,762316.603149089
                ,765394.406823245
                ,767087.382077991
                ,744872.11590305
                ,732697.534809557
                ,722263.615109734
                ,656037.515813587
                ,655597.213865659
                ,643252.637165402
                ,638294.527394965
                ,618967.54865792
                ,619055.5
                ,616223.364463669
                ,614339.067862523
                ,616185.893074463
                ,613311.86636552
                ,610303.302823602
                ,602010.54121297
                ,601672.088051196
                ,601632.936267921
                ,602734.718984718
                ,605595.335966536
                ,603824.265292626
                ,601729.245599429
                ,603589.613576403
                ,603797.943986584
                ,612476.177277754
                ,616876.513946889
                ,621380.803311091
                ,623879.888276885
                ,626662.76323161
                ,631280.074574088
                ,635985.898613514
                ,641082.994013078
                ,647005.547175922
                ,652921.977369595
                ,664234.183852657
                ,668467.481834787
                ,670978.394046769,673864.515216411
                ,678478.054691319
                ,684421.580867577
                ,683676.37866874
                ,684839.832069935
                ,684287.804979656
                ,688665.252282368
                ,687946.999027355
                ,687391.698593102
                ,688178.55961626
                ,687761.231004473
                ,685225.102058479
                ,683733.64965593
                ,681029.496576622
                ,678741.03913317
                ,676855.334558281
                ,674453.861866031
                ,672027.601923014
                ,669092.758200981
                ,663012.012503027
                ,662122.379384097
                ,661931.524967348
                ,662660.174609791
                ,665358.964550117
                ,667568.831871792
                ,658206.503118244
                ,648178.996982631
                ,644069.578461912
                ,640611.209520771
                ,634849.401511605
                ,631065.703488888
                ,627450.461788685
                ,659557.58273504
                ,659557.10005195
                ,663121.539136116
                ,665693.513242556
                ,678096.27371371
                ,681874.242890969
                ,686155.890531869
                ,688504.314350261
                ,690571.870755223
                ,693921.772069823
                ,694768.514167707
                ,695488.223405684
                ,697321.373375182
                ,699308.052767968
                ,701203.675492997
                ,702398.168020509
                ,705388.602860536
                ,705083.362189832
                ,705358.602395927
                ,709254.318694642
                ,711330.967991815
                ,716638.914647875
                ,714893.456231126
                ,715656.194112782
                ,717717.085249825
                ,714703.404589604
                ,712486.793851087
                ,711260.313089229
                ,710556.303603398
                ,708369.302450593
                ,689724.160897739
                ,689984.544916774
                ,691123.781701877
                ,692393.59884291
                ,693265.048879978
                ,673856.370523223
                ,681215.884902159
                ,684913.76877478
                ,687891.49836972
                ,691327.977494669
                ,698398.979063932
                ,703369.052618973
                ,705142.176726779
                ,709764.299999997
                ,710670.302609802
                ,711536.800375634
                ,711896.589077275
                ,703604.467550576
                ,702835.053598811
                ,699680.266529761
                ,700650.453910246
                ,700686.531970006
                ,705586.071700544
                ,703666.501475045
                ,702505.283915631
                ,701431.08259409
                ,700635.19518928
                ,699070.038665606
                ,696601.089662682
                ,693744.727659021
                ,691841.680125346
                ,690240.443516904
                ,692512.638770158
                ,695817.306281131
                ,698630.647359969
                ,701000.227474879
                ,702878.48284518
                ,706452.435716872
                ,706031.797738358
                ,704239.475891111
                ,702278.500291898
                ,720653.434529635
                ,724880.308525269
                ,729813.533231218
                ,734096.4893369
                ,736034.186384528
                ,728035.832839686
                ,719757.241370291
                ,713417.430054204
                ,708028.971861935
                ,708685.572188121
                ,708621.535310475
                ,710425.383067536
                ,711315.937731687
                ,717279.355870147
                ,719695.404437237
                ,723584.043775663
                ,723686.663450845
                ,724504.240880856
                ,727704.103833875
                ,732882.45991068
                ,734828.33482664
                ,736804.016765698
                ,735827.242517945
                ,622407.89833219
                ,746108.554123911
                ,757851.745606621
                ,760292.221881228
                ,765362.78625631
                ,768054.237872683
                ,768988.899999999
                ,772209.489165874
                ,774533.445216898
                ,777501.776856065
                ,766791.653501125
                ,767738.090168801
                ,771745.185594098
                ,775606.509278578
                ,778459.896009003
                ,753162.19376482
                ,748826.128974096
                ,738712.761434452
                ,731993.335787738
                ,732161.762442156
                ,729340.759349686
                ,723876.870537215
                ,777962.55861862
                ,615801.405917155
                ,607394.08718017
                ,607097.128178316
                ,611312.529632127
                ,607706.86603985
                ,626000.458998874
                ,624339.017958214
                ,603807.778898481
                ,602239.905378547
                ,770638.271794787
                ,769734.605919725
                ,659251.021029594
                ,705517.63370286
                ,674467.763335761
                ,680995.867377956
                ,765996.73727496
                ,762128.475090603
                ,732537.786457019
                ,708852.333163229
                ,716180.806284645
                ,650399.399596552
                ,658287.535560979
                ,653442.963635071
                ,648484.62802269
                ,654140.510176883
                ,652976.371460743
                ,657779.125210199
                ,657714.92468949
                ,642565.531272714
                ,638469.837965367
                ,757741.107833088
                ,770641.036336845
                ,642192.538082768
                ,639556.720518549
                ,662797.118881315
                ,665513.589079235
                ,658369.454353396
                ,773646.358057803
                ,696661.620225076
                ,698846.01745638
                ,621872.274063755
                ,671104.13217584
                ,657563.927367982
                ,687717.316595396
                ,744856.271611113
                ,655508.467679918
                ,633857.523174616
                ,628174.969522541
                ,671138.504790344
                ,652309.768452217
                ,651027.563582476
                ,627200.128937871
                ,598879.898377752
                ,595137.575991606
                ,731080.268596774
                ,726725.837671456
                ,731336.452631591
                ,736734.727728873
                ,741942.849174328
                ,724560.717741242
                ,721420.611835469
                ,777942.39118633
                ,731784.135651153
                ,747421.242140948
                ,748271.359700852
                ,748958.331833542
                ,666736.603010687
                ,668386.893199191
                ,656672.707460869
                ,656248.53218877
                ,659369.200000003
                ,664442.958506797
                ,666114.199688164
                ,653511.241279064
                ,654553.892148655
                ,690089.33421092
                ,664043.186594835
                ,666906.790586881
                ,755964.592164823
                ,745138.652946241
                ,659686.288302397
                ,617925.392318752
                ,613989.254696725
                ,685657.066384324
                ,690226.767695218
                ,621331.547577198
                ,741752.949190649
                ,653433.087423857
                ,715704.831794985
                ,716761.834839304
                ,661306.555642375
                ,658954.826249284
                ,662881.113736888
                ,660581.269392771
                ,718107.872618686
                ,687219.388506968
                ,725923.430659348
                ,729247.50730663
                ,729940.815629183
                ,676960.162360766
                ,679462.578360669
                ,644599.863440451
                ,600057.793017917
                ,656672.393751996
                ,737352.052247692
                ,691741.827153276
                ,699123.09607595
                ,726685.375438433
                ,681342.899784895
                ,661097.743337332
                ,644737.30080407
                ,637141.257524431
                ,635765.904538211
                ,749947.659954396
                ,751961.9189379
                ,669714.936236442
                ,636792.128746309
                ,674065.81784461
                ,678667.221862584
                ,713746.167338006
                ,747724.941338855
                ,716265.89529432
                ,615509.609577068
                ,613675.740562562
                ,630796.198377991
                ,623310.550199223
                ,658636.966716977
                ,673711.153639822
                ,679209.988995412
                ,705084.453731084
                ,632970.816891414
                ,628458.549852706
                ,647123.92904289
                ,644894.04227199
                ,626688.024505619
                ,669314.710397352
                ,708771.61468044
                ,719759.006857522
                ,626731.529195404
                ,720366.684285912
                ,691502.722467767
                ,620251.199917485
                ,665212.474372072
                ,682064.400498473
                ,669834.432748006
                ,672138.311447115
                ,671902.581140802
                ,729713.070327834
                ,641933.026595815
                ,639920.071009149
                ,627360.923818954
                ,723592.149894007
                ,635580.882306642
                ,693426.108860224
                ,684991.516999773
                ,688139.985066302
                ,605466.750686482
                ,700479.088616934
                ,725709.725757202
                ,706855.239297534
                ,615348.221782034
                ,624092.163807452
                ,621060.377047392
                ,624629.010885599
                ,625073.747919532
                ,643361.491799236
                ,683810.824884618
                ,719563.595911689
                ,659898.522275007
                ,718176.589451807
                ,721413.235870849
                ,755498.284101801
                ,764334.93549345
                ,662213.452912927
                ,693813.073085261};

        double[] yCoord = {7059186.19, 7065019.42, 7057923.10, 7056776.29, 7050511.72, 7057833.24, 7061460.64, 7068903.84, 7047847.26, 7071112.37, 7049972.24,
                7056430.63, 7100951.02749079,7088443.00402328,7081888.69018568,7076909.93454856,7070772.93558374,7068804.6430313 ,7057834.77776099,7058432.93435037
                ,7058415.47494683 ,7058180.42392514 ,7056341.96581212 ,7057209.61505213 ,7052974.13970468 ,7049238.62377254 ,7045455.57046951 ,7009926.88451099
                ,7005677.9378914 ,7004139.75337166 ,7019027.32288754 ,7000710.40191575 ,6996662.0092035 ,7004006.41909584 ,7102630.42166792 ,7104029.21100803
                ,7095444.07462207 ,7098436.86059672 ,7094455.29926136 ,7095856.9 ,7090115.96196519 ,7086972.04831189 ,7084335.51334524 ,7080666.26936999
                ,7079504.27397905 ,7075066.69612665 ,7069607.10718082, 7070934.98283257 ,7065991.83330905 ,7063465.95689145 ,7059342.21984118 ,7054058.91135667
                ,7047445.25779788 ,7036181.05195955 ,7041669.91441063 ,7039458.8855534 ,7036688.70256558 ,7035011.46072323 ,7033503.88754169 ,7031604.36072639
                ,7033519.80420577 ,7036667.11297663 ,7039079.83683671 ,7031463.69254662 ,7028922.22503833 ,7028548.62249934,7028448.97428239 ,7027790.10332626
                ,7025013.26648559 ,7021001.72796232 ,7012503.95850413 ,7007941.58486336 ,7003743.02855654 ,7026384.41323166 ,7028944.03824467 ,7030625.94135173
                ,7034406.11783998 ,7036586.56414898 ,7037836.13484616, 7037425.84387677 ,7039042.02229444 ,7040401.52712949 ,7042906.06885976 ,7047165.07714354
                ,7047660.866453
                ,7049083.10052484
                ,7051721.14324704
                ,7054862.69721121
                ,7057566.63507944
                ,7061838.78680032
                ,7065046.63559041
                ,7069922.94294601
                ,7070599.41702815
                ,7073267.59369289
                ,7081321.00057664
                ,7085386.1474093
                ,7086968.89524726
                ,7087855.12989389
                ,7088916.13441893
                ,7097144.41570297
                ,7042680.73280152
                ,7042931.494466
                ,7045402.04520119
                ,7048774.49824727
                ,7047233.79501098
                ,7047850.40549207
                ,7049407.56430508
                ,7050090.98375551
                ,7050523.12448969
                ,7052145.94250312
                ,7053047.56255804
                ,7054966.32225081
                ,7056649.85170651
                ,7057306.55928837
                ,7057499.24411856
                ,7057207.04931279
                ,7059958.12055816
                ,7060235.0240531
                ,7058556.99045235
                ,7058341.15679589
                ,7057979.32411616
                ,7051669.93477883
                ,7048182.24922373
                ,7042231.64606075
                ,7044984.77289017
                ,7047953.051711
                ,7050248.72329912
                ,7051506.62094363
                ,7054864.40074801
                ,7036083.90122987
                ,7038084.88484254
                ,7041558.40952898
                ,7044393.73249321
                ,7046041.09996653
                ,7068598.42899236
                ,7070279.65531385
                ,7068491.28870317
                ,7066668.97105405
                ,7064866.07737516
                ,7063369.37675336
                ,7061952.56072993
                ,7062655.78508203
                ,7064650.1
                ,7065547.01174014
                ,7066551.54865902
                ,7068880.9928615
                ,7063956.04592288
                ,7064947.47726176
                ,7067923.44750776
                ,7071511.20543461
                ,7073801.85430584
                ,7056407.27608572
                ,7053583.12275038
                ,7050136.94280577
                ,7046449.36606186
                ,7042536.27133053
                ,7037184.78970202
                ,7035474.71642634
                ,7035314.47157613
                ,7035276.80653731
                ,7035377.62039725
                ,7022872.88195547
                ,7024290.63891721
                ,7025497.73218905
                ,7026516.22553205
                ,7027251.53148466
                ,7030460.10791085
                ,7033390.82882897
                ,7036677.24272949
                ,7038646.62292142
                ,7041292.22927672
                ,7039914.40040337
                ,7038473.72381319
                ,7032595.51337624
                ,7032546.09323267
                ,7031953.56738585
                ,7028678.76771066
                ,7029311.97106053
                ,7028763.69856872
                ,7023858.92071752
                ,7020942.66172381
                ,7020038.04802641
                ,7018970.98440799
                ,7008789.0730089
                ,7010451.44364782
                ,7014253.15362466
                ,7020068.20197692
                ,7023662.37182384
                ,7026390.02553315
                ,7024424.85184648
                ,7026051.90065138
                ,7029639.53467655
                ,7025924.77898254
                ,7094917.75113367
                ,7017125.0705708
                ,7011420.24263982
                ,7011345.41840562
                ,7017702.22678483
                ,7019337.45327286
                ,7019830.4
                ,7020690.73202011
                ,7021179.62645648
                ,7022575.03275115
                ,7003581.88449971
                ,7002789.20681841
                ,6999407.59426412
                ,6991280.46268412
                ,6987914.1206754
                ,7006921.72570971
                ,7003555.47197446
                ,6999355.61774672
                ,6993560.74390384
                ,6999291.14006528
                ,7001524.00103978
                ,7003391.57520094
                ,6980067.31680528
                ,7001041.57524369
                ,7010662.62899671
                ,7001941.54400327
                ,6954406.56281174
                ,6951306.31311023
                ,6940019.22092908
                ,6941808.35068002
                ,6999066.55730778
                ,6997497.59657689
                ,6923616.68505024
                ,6926590.0050889
                ,6941613.55552628
                ,6892832.88428807
                ,6989744.6068522
                ,6999746.67845076
                ,6932093.52839439
                ,6936727.16560967
                ,6933063.0798213
                ,6942416.39482612
                ,6945777.37630053
                ,6977034.45251519
                ,6975538.63895122
                ,6974095.97068305
                ,6977389.68049876
                ,6961914.33246641
                ,6955468.05719027
                ,6927409.3945679
                ,6920818.98905055
                ,6981380.11001277
                ,6983387.13549682
                ,6964844.76178131
                ,6973864.08235005
                ,6899721.34367286
                ,6901738.46335494
                ,6893266.58874926
                ,6973885.49110621
                ,6930012.68034459
                ,6977359.4776226
                ,6937189.45566936
                ,6940434.93878431
                ,6962063.92036306
                ,6912324.22086014
                ,6901747.42358469
                ,6971490.8442944
                ,6911906.96855601
                ,6947642.14208922
                ,6925583.42127601
                ,6932576.87892833
                ,6985198.77208968
                ,6910680.40579087
                ,6913648.945567
                ,6964801.50679971
                ,6997014.56282754
                ,6996560.66945673
                ,6983585.51235235
                ,6951032.081071
                ,6950994.93257104
                ,6901111.0849909
                ,6910949.52846787
                ,6918875.17120192
                ,6971262.67913293
                ,6981984.80547014
                ,6987848.286429
                ,6948183.294925
                ,6950212.06436431
                ,6952510.8381647
                ,6955281.80800798
                ,6949248.4015846
                ,6972109.56842259
                ,6966927.58745673
                ,6968247.1
                ,6959686.82018016
                ,6957409.00785365
                ,6896572.37683466
                ,6900583.66020299
                ,6929767.35757546
                ,6979351.86506479
                ,6982851.43408597
                ,6939968.33306203
                ,6941465.71505208
                ,6914043.17525391
                ,6907426.88400155
                ,6909874.00959055
                ,6967636.64604165
                ,6964805.13045875
                ,6900843.98982834
                ,6938443.57597922
                ,6908212.38757896
                ,6906183.04832008
                ,6908141.5163832
                ,6907260.39304411
                ,6905853.67305937
                ,6909337.67225586
                ,6898788.10101256
                ,6947619.85645339
                ,6924791.52477497
                ,6922766.29994126
                ,6926748.60851183
                ,6882077.53018492
                ,6915354.58589719
                ,6915922.3831789
                ,6896230.45567528
                ,6997158.6620908
                ,6906492.10321235
                ,6947262.2942843
                ,6903495.81704918
                ,6903801.74122519
                ,6876955.46231433
                ,6888478.47294056
                ,6977969.18240138
                ,6979794.42059104
                ,6910215.3788655
                ,6916780.60416234
                ,6956170.34250441
                ,6958795.01408792
                ,6940391.78206665
                ,6903981.05823032
                ,6926599.00987801
                ,6926005.70337554
                ,6957760.88233089
                ,6949304.57604538
                ,6956987.06669675
                ,6951230.54219997
                ,6952202.29017343
                ,6963550.321317
                ,6951637.34946209
                ,6933959.391485
                ,6971856.86619031
                ,6969359.70351212
                ,6960073.85170523
                ,6987483.16339349
                ,6990786.61758036
                ,6915907.94658167
                ,6917465.9802604
                ,6934272.75272599
                ,6984202.52255942
                ,6897766.36803351
                ,6898649.52626321
                ,6991911.91038858
                ,6910243.300478
                ,6930743.5362044
                ,6902894.74107036
                ,6911116.82798096
                ,6917782.80845152
                ,6972815.69606085
                ,6972244.33698656
                ,6933636.61032887
                ,6930605.79953764
                ,6920501.53823677
                ,6922452.35299533
                ,6937263.78432815
                ,6874357.88834265
                ,6968064.96432624
                ,6962802.86851284
                ,6893682.81284589
                ,6900050.91674034
                ,7020350.25659435
                ,6941973.36869162
                ,6898704.32469467
                ,6905618.55290657
                ,6960385.70361788
                ,6992829.47851389
                ,6994835.95519815
                ,6944596.8760641
                ,6949139.29056114
                ,6919008.60088511
                ,6920783.61866938
                ,6954760.40885292
                ,6910613.74578106
                ,6959922.34870917
                ,6951169.99375975
                ,6961178.90254843
                ,6970503.74952787
                ,6964321.15136259
                ,6933684.94293185
        };

        /*
         * double Lat = 50.62964, Long = 2.93251586; X = 695217.09, Y = 7059186.19;
         * 50.6819458 2.878044; X = 691365.43, Y = 7065019.42; 50.6183128 3.049986 X =
         * 703543.53, Y = 7057923.10 50.6080246 3.03906918 X = 702770.20, Y = 7056776.29
         * 50.5517769 2.914486 X = 693929.84, Y = 7050511.72 50.6175 3.06391 X =
         * 704530.69, Y = 7057833.24 50.6500053 3.12651539 X = 708963.08, Y = 7061460.64
         * 50.71675 3.166937 X = 711811.05, Y = 7068903.84 50.5277328 2.80166936 X =
         * 685914.90, Y = 7047847.26 50.73656 3.17222 X = 712180.02, Y = 7071112.37
         * 50.54696 3.032925 X = 702337.39, Y = 7049972.24 50.60485 3.139705 X =
         * 709906.41, Y = 7056430.63
         */

        for (int i = 0; i < yCoord.length; i++) {
            Coord prCoord = new Coord(xCoord[i], yCoord[i]);
            parkRideCoords.add(prCoord);
        }

        // Eqasim config definition to add the mode car_pt estimation
        EqasimConfigGroup eqasimConfig = EqasimConfigGroup.get(config);
        eqasimConfig.setEstimator("car_pt", "CarPtUtilityEstimator");
        eqasimConfig.setEstimator("pt_car", "PtCarUtilityEstimator");

        // Scoring config definition to add the mode cat_pt parameters
        PlanCalcScoreConfigGroup scoringConfig = config.planCalcScore();
        ModeParams carPtParams = new ModeParams("car_pt");
        ModeParams ptCarParams = new ModeParams("pt_car");
        scoringConfig.addModeParams(carPtParams);
        scoringConfig.addModeParams(ptCarParams);

        // "car_pt interaction" definition
        ActivityParams paramsCarPtInterAct = new ActivityParams("carPt interaction");
        paramsCarPtInterAct.setTypicalDuration(100.0);
        paramsCarPtInterAct.setScoringThisActivityAtAll(false);

        // "pt_car interaction" definition
        ActivityParams paramsPtCarInterAct = new ActivityParams("ptCar interaction");
        paramsPtCarInterAct.setTypicalDuration(100.0);
        paramsPtCarInterAct.setScoringThisActivityAtAll(false);

        // Adding "car_pt interaction" to the scoring
        scoringConfig.addActivityParams(paramsCarPtInterAct);
        scoringConfig.addActivityParams(paramsPtCarInterAct);

        // DMC config definition
        DiscreteModeChoiceConfigGroup dmcConfig = (DiscreteModeChoiceConfigGroup) config.getModules()
                .get(DiscreteModeChoiceConfigGroup.GROUP_NAME);

        // Adding the mode "car_pt" and "pt_car" to CachedModes
        Collection<String> cachedModes = new HashSet<>(dmcConfig.getCachedModes());
        cachedModes.add("car_pt");
        cachedModes.add("pt_car");
        dmcConfig.setCachedModes(cachedModes);

        // Activation of constraint intermodal modes Using
        Collection<String> tourConstraints = new HashSet<>(dmcConfig.getTourConstraints());
        //tourConstraints.add("VehicleTourConstraintWithCar_Pt");
        tourConstraints.add("IntermodalModesConstraint");
        dmcConfig.setTourConstraints(tourConstraints);


        for (StrategySettings strategy : config.strategy().getStrategySettings()) {
            if(strategy.getName().equals("DiscreteModeChoice")) {
                strategy.setWeight(1000000000.0);
            }
        }


        Scenario scenario = ScenarioUtils.createScenario(config);
        MELConfigurator.configureScenario(scenario);
        ScenarioUtils.loadScenario(scenario);

        Controler controller = new Controler(scenario);
        MELConfigurator.configureController(controller);
        controller.addOverridingModule(new EqasimAnalysisModule());
        controller.addOverridingModule(new EqasimModeChoiceModuleCarPt());
        controller.addOverridingModule(new MELModeChoiceModuleCarPt(cmd, parkRideCoords,scenario.getNetwork(), scenario.getPopulation().getFactory()));
        controller.addOverridingModule(new EqasimCarPtModule(parkRideCoords));
        controller.addOverridingModule(new EqasimPtCarModule(parkRideCoords));
        controller.run();
    }

}
